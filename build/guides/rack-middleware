<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<link href="/blog/feed.xml" rel="alternate" title="Middleman Blog" type="application/atom+xml">
<link href="/stylesheets/site.css?1312569286" media="screen" rel="stylesheet" type="text/css">
<link href="/stylesheets/pygments/solarized.css?1312479203" media="screen" rel="stylesheet" type="text/css">
<title>Middleman: Rack Middleware</title>
</head>
<body>
    <div id="frame">
      <div class="container">
        <aside><header><h1><a href="/">Middleman</a></h1>
            <h4>Hand-crafted frontend development</h4>
          </header><h3>All Guides</h3>
          <nav><ul>
<li><a href="/guides/getting-started">Getting Started</a></li>
              <li><a href="/guides/migrating">Migrating to Middleman 2.0</a></li>
              <li><a href="/guides/templates-layouts-partials">Templates, Layouts and Partials</a></li>
              <li><a href="/guides/sass-and-compass">Sass and Compass</a></li>
              <li><a href="/guides/js-coffee-and-sprockets">Javascript, CoffeeScript and Sprockets</a></li>
              <li><a href="/guides/dynamic-pages">Dynamic Pages</a></li>
              <li><a href="/guides/pretty-urls">Pretty URLs (Directory Indexes)</a></li>
              <li><a href="/guides/frontend-optimization">Frontend Optimization</a></li>
              <li><a href="/guides/individual-page-configuration">Individual Page Configuration (YAML Frontmatter)</a></li>
              <li><a href="/guides/livereload">LiveReload</a></li>
              <li><a href="/guides/local-yaml-data">Local YAML Data</a></li>
              <li><a href="/guides/extensions">Custom Extensions</a></li>
              <li><a href="/guides/rack-middleware">Rack Middleware</a></li>
            </ul></nav><h3>Blog Posts</h3>
          <ul>
<li>
              <small>Jul 11</small><br><a href="/blog/2011/07/11/brand-new-documentation">Brand New Documentation</a>
</li>
          </ul>
<h3>Other</h3>
          <ul>
<li><a href="/built-using-middleman">Sites Built Using Middleman</a></li>
          </ul>
<footer><p>This site is itself a Middleman project.
            Fork &amp; contribute <a href="https://github.com/tdreyno/middleman-guides">on GitHub</a>.<br><br>
            Middleman is open-source software licensed under the <a href="https://github.com/tdreyno/middleman/blob/master/LICENSE">MIT License</a>.<br><br>
            Â© 2011 <a href="http://awardwinningfjords.com">Thomas Reynolds</a></p> </footer></aside><article id="main" role="main"><h1>Rack Middleware</h1>

<p>Rack is a system of classes that can modify content on-the-fly and intercept requests before they are processed by the server (Middleman).</p>

<p>Middleman has full access to Rack Middleware which opens up an expansive universe of libraries which work with Middleman.</p>

<h2>Example</h2>

<p>This site is written in Middleman and features many code blocks which have syntax highlighting. This syntax highlighting is accomplished outside the scope of Middleman. This site renders <code>&lt;code&gt;</code> blocks and then Rack Middleware takes over an enhances those blocks with syntax highlight. The middleware in use is called <code>Rack::Codehighlighter</code>. Here's how it can be used in your <code>config.rb</code>:</p>

<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'rack/codehighlighter'</span>
<span class="n">use</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Codehighlighter</span><span class="p">,</span> 
  <span class="ss">:pygments_api</span><span class="p">,</span>
  <span class="ss">:element</span> <span class="o">=&gt;</span> <span class="s2">"pre&gt;code"</span><span class="p">,</span>
  <span class="ss">:pattern</span> <span class="o">=&gt;</span> <span class="sr">/\A:::([-_+\w]+)\s*\n/</span><span class="p">,</span>
  <span class="ss">:markdown</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</pre></div>


<p>The above block required the <code>rack/codehighlighter</code> library, which must first be installed via RubyGems. Then the <code>use</code> command tells Middleman to use this middleware. The rest is standard Rack Middleware setup, passing some variables to the middleware itself instructing the syntax highlighter on how to locate code blocks and which backend to use for parsing the syntax.</p>

<h3>Build Cycle</h3>

<p>The Rack Middleware is run on all requests, including those done during the build cycle. This means anything the Rack Middleware effects during preview will be present in the built files. However, be aware that once the project is built, it is a static site. Rack Middleware which does processing on requests, expecting things like cookies, sessions or variables, won't work once the site is built.</p>

<h2>Useful Middleware</h2>

<ul>
<li><a href="https://github.com/ambethia/rack-google_analytics">Rack::GoogleAnalytics</a></li>
<li><a href="https://github.com/rbialek/rack-tidy">Rack::Tidy</a></li>
<li><a href="https://gist.github.com/235715">Rack::Validate</a></li>
<li><a href="https://gist.github.com/235097">Rack::SpellCheck</a></li>
</ul></article>
</div>
    </div>
<!-- Google Analytics --><script type="text/javascript">  var _gaq = _gaq || [];  _gaq.push(['_setAccount', 'UA-90027-21']);  _gaq.push(['_trackPageview']);  (function() {    var ga = document.createElement('script');    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';    ga.setAttribute('async', 'true');    document.documentElement.firstChild.appendChild(ga);  })();</script>
</body>
</html>
